<!DOCTYPE html>
<html>
<head>
<title>SVG Editor</title>
<style>
  body { font-family: sans-serif; }
  #svg-container { border: 1px solid #ccc; margin-bottom: 20px; }
  .controls { margin-bottom: 10px; }
</style>
</head>
<body>

  <h1>SVG Editor</h1>

  <div class="controls">
    <label for="svg-file">Carica file SVG:</label>
    <input type="file" id="svg-file" accept=".svg">
  </div>

  <div id="svg-container">
    </div>

  <script>
    const svgFileElement = document.getElementById('svg-file');
    const svgContainer = document.getElementById('svg-container');

    const raggruppamenti = {
      "Basi A1": ["Atella", "Palazzo San Gervasio", "Pescopagano", "Barile", "Rapolla", "Rapone", "Rionero in Vulture", "Ripacandida", "Ruvo del Monte", "San Fele", "Filiano", "Forenza", "Lavello", "Maschito", "Melfi", "Montemilone", "Venosa", "Ginestra"],
      "Basi A2": ["Balvano", "Muro Lucano", "Baragiano", "Picerno", "Bella", "Brienza", "Castelgrande", "Ruoti", "Sant’ Angelo Le Fratte", "Sasso di Castalda", "Satriano di Lucania", "Savoia di Lucania", "Vietri di Potenza", "Tito"],
      "Basi B": ["Abriola", "Accettura", "Acerenza", "Albano di Lucania", "Anzi", "Avigliano", "Banzi", "Brindisi Montagna", "Calciano", "Calvello", "Campomaggiore", "Cancellara", "Castelmezzano", "Ferrandina", "Garaguso", "Genzano di Lucania", "Grassano", "Grottole", "Irsina", "Laurenzana", "Matera", "Miglionico", "Oliveto Lucano", "Oppido Lucano", "Pietragalla", "Pietrapertosa", "Pignola", "Pomarico", "Potenza", "Salandra", "San Chirico Nuovo", "San Mauro Forte", "Tolve", "Tricarico", "Trivigno", "Vaglio Basilicata"],
      "Basi C": ["Aliano", "Armento", "Calvera", "Carbone", "Castronuovo di Sant’ Andrea", "Cersosimo", "Chiaromonte", "Cirigliano", "Colobraro", "Corleto Perticara", "Episcopia", "Fardella", "Francavilla in Sinni", "Gallicchio", "Gorgoglione", "Grumento Nova", "Guardia Perticara", "Missanello", "Moliterno", "Montemurro", "Nemoli", "Noepoli", "Paterno", "Roccanova", "San Chirico Raparo", "San Costantino Albanese", "San Giorgio Lucano", "San Martino d’Agri", "San Paolo Albanese", "San Severino Lucano", "Sant’ Arcangelo", "Sarconi", "Senise", "Spinoso", "Stigliano", "Teana", "Terranova di Pollino", "Tramutola", "Tursi", "Valsinni", "Viggiano"],
      "Basi D": ["Castelluccio Inferiore", "Castelluccio Superiore", "Castelsaraceno", "Lagonegro", "Latronico", "Lauria", "Maratea", "Nemoli", "Rivello", "Rotonda", "Trecchina", "Viggianello"],
      "Basi E1": ["Craco", "Montalbano Jonico", "Nova Siri", "Policoro", "Rotondella", "Scanzano Jonico", "Tursi"],
      "Basi E2": ["Bernalda", "Montescaglioso", "Pisticci", "Pomarico", "Ferrandina"]
    };

    let svgDocument;
    let idElements = {};

    svgFileElement.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          svgContainer.innerHTML = e.target.result;
          svgDocument = svgContainer.querySelector('svg');
          if (svgDocument) {
            extractAndGroupElements();
          } else {
            alert('Il file caricato non sembra essere un SVG valido.');
          }
        };
        reader.readAsText(file);
      }
    });

    function extractAndGroupElements() {
      idElements = {};
      const allElements = svgDocument.querySelectorAll('*[id]');
      allElements.forEach(element => {
        const id = element.getAttribute('id');
        idElements[id] = element;
      });
      console.log("ID Elements:", idElements);

      for (const nuovoId in raggruppamenti) {
        const comuniDelGruppo = raggruppamenti[nuovoId];
        const elementsToGroup = comuniDelGruppo.map(comuneId => idElements[comuneId]).filter(el => el);

        if (elementsToGroup.length > 0) {
          const newGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
          newGroup.setAttribute('id', nuovoId);

          elementsToGroup.forEach(element => {
            newGroup.appendChild(element);
          });

          // Aggiungi il nuovo gruppo come primo figlio dell'elemento <svg>
          const firstElement = svgDocument.firstChild;
          svgDocument.insertBefore(newGroup, firstElement);

          // Rimuovi gli elementi originali (ora figli del gruppo)
          elementsToGroup.forEach(element => {
            // L'elemento è già stato spostato, non c'è bisogno di rimuoverlo qui
          });
        } else {
          console.warn(`Nessun elemento trovato per il gruppo: ${nuovoId}`);
        }
      }

      alert('Raggruppamento automatico completato!');
    }
  </script>

</body>
</html>
