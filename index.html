<!DOCTYPE html>
<html>
<head>
    <title>Estrai ID Comuni da SVG</title>
</head>
<body>
    <input type="file" id="fileInput">
    <button onclick="estraiIdComuni()">Estrai ID</button>
    <p id="conteggioId"></p>
    <ul id="listaIdComuni"></ul>
    <pre id="codiceSvg"></pre>

    <script>
        function estraiIdComuni() {
            const fileInput = document.getElementById('fileInput');
            const listaIdComuni = document.getElementById('listaIdComuni');
            const conteggioId = document.getElementById('conteggioId');
            const codiceSvg = document.getElementById('codiceSvg');
            listaIdComuni.innerHTML = '';
            conteggioId.textContent = '';
            codiceSvg.textContent = '';

            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const svgString = event.target.result;
                    const parser = new DOMParser();
                    const svgDoc = parser.parseFromString(svgString, 'image/svg+xml');
                    const elementiComuni = svgDoc.querySelectorAll('[id]');

                    const idComuni = [];
                    elementiComuni.forEach(elemento => {
                        const idComune = elemento.id;
                        if (idComune) {
                            idComuni.push(idComune);
                        }
                    });

                    idComuni.sort();

                    idComuni.forEach(idComune => {
                        const elementoTrovato = svgDoc.getElementById(idComune);
                        if (elementoTrovato) {
                            const listItem = document.createElement('li');
                            listItem.textContent = idComune;
                            listaIdComuni.appendChild(listItem);
                            codiceSvg.textContent += `ID: ${idComune}\n${elementoTrovato.outerHTML}\n\n`;
                        } else {
                            codiceSvg.textContent += `Errore: Porzione con ID '${idComune}' non trovata.\n\n`;
                        }
                    });

                    conteggioId.textContent = `Trovati ${idComuni.length} ID`;
                };
                reader.readAsText(file);
            }
        }
    </script>
</body>
</html>
