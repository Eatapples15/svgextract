<!DOCTYPE html>
<html>
<head>
    <title>Modifica ID SVG</title>
</head>
<body>
    <input type="file" id="fileInput">
    <button onclick="modificaIdSvg()">Modifica ID e Salva SVG</button>
    <a id="downloadLink" style="display: none;">Scarica Nuovo SVG</a>

    <script>
        function modificaIdSvg() {
            const fileInput = document.getElementById('fileInput');
            const downloadLink = document.getElementById('downloadLink');

            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const svgString = event.target.result;
                    const parser = new DOMParser();
                    const svgDoc = parser.parseFromString(svgString, 'image/svg+xml');

                    // Lista dei nomi dei comuni da cercare
                    const nomiComuni = ["Atella", "Chiaromonte", "Fardella", "Maratea", "Matera", "Noepoli", "SanMartinodAgri", "Tito", "Tricarico", "p_MT", "p_PZ"];

                    // Trova e modifica gli ID degli elementi <path> e <g>
                    nomiComuni.forEach(nomeComune => {
                        const elementi = svgDoc.querySelectorAll(`path[id="${nomeComune}"], g[id="${nomeComune}"]`);
                        if (elementi.length > 0) {
                            //Se l'id è già corretto, non fare niente.
                        } else {
                          const elementi2 = svgDoc.querySelectorAll(`path[id], g[id]`);
                          elementi2.forEach(element =>{
                            if(element.id.toLowerCase() === nomeComune.toLowerCase()){
                              element.id = nomeComune;
                            }
                          })
                        }
                    });

                    // Crea il nuovo file SVG
                    const nuovoSvgString = new XMLSerializer().serializeToString(svgDoc);
                    const blob = new Blob([nuovoSvgString], { type: 'image/svg+xml' });
                    const url = URL.createObjectURL(blob);

                    downloadLink.href = url;
                    downloadLink.download = 'nuovo_svg_modificato.svg';
                    downloadLink.style.display = 'block';
                };
                reader.readAsText(file);
            }
        }
    </script>
</body>
</html>
